

[include shell_command.cfg]
# This file contains common pin mappings for the BigTreeTech Octopus V1.
# To use this config, the firmware should be compiled for the STM32F446 with a "32KiB bootloader"
# Enable "extra low-level configuration options" and select the "12MHz crystal" as clock reference

# after running "make", copy the generated "klipper/out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the OctoPus with that SD card.

# See docs/Config_Reference.md for a description of parameters.

## Voron Design VORON2 250/300/350mm BigTreeTech OctoPus V1 TMC2209 UART config

[include mainsail.cfg]
[include homing.cfg]
[include bed_mesh.cfg]
[include stealthburner_leds.cfg]
[include KAMP_Settings.cfg]
[include canbus.cfg]
[include bedfans.cfg]
[include macros.cfg]
[include beacon.cfg]
[exclude_object]
[force_move]
enable_force_move: True
[pause_resume]

[mcu]
canbus_uuid: 993242c5d629

[printer]
kinematics: corexy
max_velocity: 500  
max_accel:7000              #Max 4000
max_z_velocity: 50          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 300
square_corner_velocity: 5.0

#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to MOTOR_0
##  Endstop connected to DIAG_0
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_x:virtual_endstop
#position_min: 0


##  Uncomment for 300mm build
position_endstop: 306
position_max: 306
homing_speed: 40   #Max 100
homing_retract_dist: 0
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_x]
uart_pin: PC4
interpolate: false
run_current: 1.0
sense_resistor: 0.110
diag_pin: ^PG6
driver_SGTHRS: 135 # 255 is most sensitive value, 0 is least sensitive
stealthchop_threshold:0 #always on, 0 is off

##  A Stepper - Right
##  Connected to MOTOR_1
##  Endstop connected to DIAG_1
[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_y:virtual_endstop
#position_min: 0


##  Uncomment for 300mm build
position_endstop: 314
position_max: 314
homing_speed: 40  #Max 100
homing_retract_dist: 0.5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_y]
uart_pin: PD11
interpolate: false
run_current: 1.0
sense_resistor: 0.110
diag_pin: ^PG9
driver_SGTHRS: 142 # 255 is most sensitive value, 0 is least sensitive
stealthchop_threshold:0 #always on, 0 is off
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to MOTOR_2
##  Endstop connected to DIAG_2
[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16
endstop_pin: probe:z_virtual_endstop # use beacon as virtual endstop
homing_retract_dist: 0 # beacon needs this to be set to 0 
#position_endstop: -0.5


##--------------------------------------------------------------------
##  Uncomment below for 300mm build
position_max: 260
position_min: -5
homing_speed: 20
second_homing_speed: 3
homing_retract_dist: 3

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z]
uart_pin: PC6
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Left
##  Connected to MOTOR_3
[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Rear Right
##  Connected to MOTOR_4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z3 Stepper - Front Right
##  Connected to MOTOR_5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
#   Bed Heater
#####################################################################
[heater_bed]
heater_pin: PA1
sensor_type: Generic 3950
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.85
min_temp: 0
max_temp: 125
[verify_heater heater_bed]
max_error: 120
# The default is 120.
check_gain_time:60
# The default is 20 seconds for extruders
#   and 60 seconds for heater_bed.
hysteresis: 5
#    The default is 5.
heating_gain: 2
#    The default is 2.

#####################################################################
#   Fan Control
#####################################################################
##  Controller fan - FAN2
[controller_fan Octopus_fan]
pin: PD14
kick_start_time: 0.5
heater: heater_bed

##  Exhaust fan - FAN3
[fan_generic Exhaust_Fan]
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 0.5

#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting - HE2 Connector (Optional)
[output_pin Chamber_LED]
pin: PD15
pwm:true
shutdown_value: 0
value:0.75
cycle_time: 0.01

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################
[idle_timeout]
timeout: 1800

[quad_gantry_level]
gantry_corners:
	-60,-10
	360,370
##	Probe points
points:
	50,25
	50,225
	250,225
	250,25
speed: 600
horizontal_move_z: 10
retries: 10
retry_tolerance: 0.0075
max_adjust: 10

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 54.137
#*# pid_ki = 2.472
#*# pid_kd = 296.400
#*#
#*# [probe]
#*# z_offset = -0.410
#*#
#*# [input_shaper]
#*# shaper_type_x = ei
#*# shaper_freq_x = 60.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 39.4
#*#
#*# [beacon model default]
#*# model_coef = 1.7756842564643547,
#*# 	  2.0383602309658544,
#*# 	  0.6047674354552829,
#*# 	  0.30858278218480983,
#*# 	  0.24740427348977845,
#*# 	  -0.04350403955376604,
#*# 	  -0.13226724908767137,
#*# 	  0.14272135982543963,
#*# 	  0.10619338638776032,
#*# 	  -0.042497217575236466
#*# model_domain = 1.9090007618859247e-07,1.940089171082431e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 45.285838
#*# model_offset = 0.57000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.042786, 0.019468, 0.000355, -0.017283, -0.030400, -0.033217, -0.032711, -0.035699, -0.039681, -0.039535, -0.034922, -0.026094, -0.016078, -0.008195, 0.002315, 0.009906, 0.018235, 0.026859, 0.034230, 0.041445
#*# 	  0.042465, 0.025718, 0.011103, -0.005277, -0.017324, -0.024116, -0.028330, -0.030345, -0.033728, -0.032159, -0.027908, -0.019630, -0.012391, -0.003584, 0.005231, 0.015751, 0.023749, 0.031586, 0.037549, 0.044457
#*# 	  0.032524, 0.019349, 0.008974, -0.004776, -0.018066, -0.026372, -0.031131, -0.036451, -0.038200, -0.037861, -0.034364, -0.025630, -0.018120, -0.012089, -0.003994, 0.005575, 0.015444, 0.022064, 0.027799, 0.038295
#*# 	  0.035654, 0.026958, 0.017340, 0.002698, -0.008720, -0.017663, -0.024799, -0.029297, -0.033447, -0.031004, -0.027154, -0.021904, -0.015132, -0.008459, -0.002009, 0.009167, 0.016949, 0.024424, 0.030807, 0.045695
#*# 	  0.040584, 0.035788, 0.026743, 0.008993, -0.009376, -0.017784, -0.023800, -0.029205, -0.029692, -0.031092, -0.029370, -0.024441, -0.017448, -0.010152, -0.003834, 0.003270, 0.009488, 0.016692, 0.025195, 0.042123
#*# 	  0.036374, 0.040166, 0.027314, 0.001338, -0.021198, -0.032012, -0.035746, -0.039470, -0.042325, -0.041986, -0.040393, -0.037077, -0.031004, -0.023594, -0.014714, -0.010660, -0.005279, 0.002465, 0.011037, 0.023906
#*# 	  0.042938, 0.053942, 0.038106, 0.004085, -0.022224, -0.031287, -0.035634, -0.037292, -0.040998, -0.041614, -0.040318, -0.036436, -0.029856, -0.023745, -0.016366, -0.010235, -0.004165, 0.003008, 0.008489, 0.018097
#*# 	  0.046726, 0.055067, 0.040707, 0.008003, -0.015340, -0.022693, -0.026898, -0.029446, -0.031482, -0.032733, -0.032390, -0.027857, -0.023041, -0.015958, -0.008971, -0.000475, 0.005790, 0.011701, 0.016734, 0.024926
#*# 	  0.039653, 0.037467, 0.024652, 0.005133, -0.012172, -0.018982, -0.022983, -0.024602, -0.024934, -0.027163, -0.026565, -0.023156, -0.018422, -0.011817, -0.004755, 0.004127, 0.009385, 0.017003, 0.022796, 0.030496
#*# 	  0.037302, 0.029528, 0.017823, 0.005482, -0.007272, -0.013820, -0.018353, -0.019173, -0.018489, -0.018484, -0.019669, -0.017587, -0.014056, -0.010107, -0.001345, 0.007419, 0.013433, 0.019445, 0.025114, 0.033065
#*# 	  0.036609, 0.025512, 0.015899, 0.006342, -0.002106, -0.009183, -0.015126, -0.017434, -0.016495, -0.014308, -0.015098, -0.013406, -0.012213, -0.008447, -0.000809, 0.006077, 0.013892, 0.019379, 0.024950, 0.033910
#*# 	  0.036127, 0.025532, 0.016575, 0.008838, 0.001414, -0.008427, -0.012786, -0.014900, -0.015274, -0.014395, -0.012548, -0.011574, -0.009639, -0.005634, 0.001174, 0.007987, 0.014804, 0.020021, 0.026266, 0.035442
#*# 	  0.035585, 0.026955, 0.018387, 0.010150, 0.001342, -0.004861, -0.008843, -0.010173, -0.011993, -0.010037, -0.009513, -0.006942, -0.005769, -0.002853, 0.003878, 0.011690, 0.016887, 0.023036, 0.029928, 0.038785
#*# 	  0.031770, 0.023081, 0.014614, 0.007298, -0.001933, -0.006184, -0.010201, -0.010972, -0.012040, -0.011065, -0.010732, -0.007801, -0.007193, -0.006299, 0.002296, 0.008592, 0.013760, 0.020852, 0.027482, 0.036040
#*# 	  0.023507, 0.016029, 0.006796, -0.001897, -0.008261, -0.012726, -0.013413, -0.016909, -0.018238, -0.016602, -0.015469, -0.015153, -0.012554, -0.009703, -0.001667, 0.006891, 0.012541, 0.018417, 0.022455, 0.032362
#*# 	  0.026064, 0.018374, 0.008737, -0.001124, -0.005190, -0.009616, -0.010871, -0.012419, -0.014812, -0.011468, -0.010595, -0.009723, -0.005905, -0.001409, 0.007957, 0.016177, 0.020418, 0.023368, 0.028615, 0.040440
#*# 	  0.033863, 0.026206, 0.018046, 0.011614, 0.003336, 0.001200, -0.001167, -0.002432, -0.003349, -0.001613, -0.001160, 0.003328, 0.006948, 0.012066, 0.022601, 0.028308, 0.032303, 0.036641, 0.043971, 0.053501
#*# 	  0.039795, 0.034052, 0.025802, 0.018698, 0.013817, 0.008232, 0.005811, 0.006153, 0.005517, 0.006426, 0.007695, 0.008894, 0.015603, 0.022100, 0.030173, 0.036928, 0.038727, 0.045126, 0.052614, 0.062524
#*# 	  0.046616, 0.040184, 0.034010, 0.026624, 0.019463, 0.014457, 0.011716, 0.011598, 0.013759, 0.013586, 0.012866, 0.014852, 0.022506, 0.029949, 0.037264, 0.041049, 0.043006, 0.050660, 0.060002, 0.071878
#*# 	  0.052082, 0.045136, 0.038377, 0.031628, 0.026260, 0.021089, 0.017245, 0.017372, 0.017808, 0.018562, 0.018484, 0.021477, 0.027279, 0.035716, 0.042740, 0.044309, 0.048130, 0.056209, 0.066753, 0.077859
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 1
#*# mesh_y_pps = 1
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 250.0
#*# min_y = 30.0
#*# max_y = 250.0
