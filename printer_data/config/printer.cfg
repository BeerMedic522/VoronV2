

[include shell_command.cfg]
# This file contains common pin mappings for the BigTreeTech Octopus V1.
# To use this config, the firmware should be compiled for the STM32F446 with a "32KiB bootloader"
# Enable "extra low-level configuration options" and select the "12MHz crystal" as clock reference

# after running "make", copy the generated "klipper/out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the OctoPus with that SD card.

# See docs/Config_Reference.md for a description of parameters.

## Voron Design VORON2 250/300/350mm BigTreeTech OctoPus V1 TMC2209 UART config

[include mainsail.cfg]
[include homing.cfg]
[include bed_mesh.cfg]
[include stealthburner_leds.cfg]
[include KAMP_Settings.cfg]
[include canbus.cfg]
[include bedfans.cfg]
[include macros.cfg]
[include beacon.cfg]

[exclude_object]

[force_move]
enable_force_move: True
[pause_resume]

[mcu]
canbus_uuid: 993242c5d629

[printer]
kinematics: corexy
max_velocity: 500  
max_accel:7000              #Max 4000
max_z_velocity: 50          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 300
square_corner_velocity: 5.0

#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to MOTOR_0
##  Endstop connected to DIAG_0
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_x:virtual_endstop
#position_min: 0


##  Uncomment for 300mm build
position_endstop: 306
position_max: 306
homing_speed: 40   #Max 100
homing_retract_dist: 0
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_x]
uart_pin: PC4
interpolate: false
run_current: 1.0
sense_resistor: 0.110
diag_pin: ^PG6
driver_SGTHRS: 135 # 255 is most sensitive value, 0 is least sensitive
stealthchop_threshold:0 #always on, 0 is off

##  A Stepper - Right
##  Connected to MOTOR_1
##  Endstop connected to DIAG_1
[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_y:virtual_endstop
#position_min: 0


##  Uncomment for 300mm build
position_endstop: 314
position_max: 314
homing_speed: 40  #Max 100
homing_retract_dist: 0.5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_y]
uart_pin: PD11
interpolate: false
run_current: 1.0
sense_resistor: 0.110
diag_pin: ^PG9
driver_SGTHRS: 142 # 255 is most sensitive value, 0 is least sensitive
stealthchop_threshold:0 #always on, 0 is off
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to MOTOR_2
##  Endstop connected to DIAG_2
[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16
endstop_pin: probe:z_virtual_endstop # use beacon as virtual endstop
homing_retract_dist: 0 # beacon needs this to be set to 0 
#position_endstop: -0.5


##--------------------------------------------------------------------
##  Uncomment below for 300mm build
position_max: 260
position_min: -5
homing_speed: 20
second_homing_speed: 3
homing_retract_dist: 3

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z]
uart_pin: PC6
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Left
##  Connected to MOTOR_3
[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Rear Right
##  Connected to MOTOR_4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z3 Stepper - Front Right
##  Connected to MOTOR_5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
#   Bed Heater
#####################################################################
[heater_bed]
heater_pin: PA1
sensor_type: Generic 3950
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.85
min_temp: 0
max_temp: 125
[verify_heater heater_bed]
max_error: 120
# The default is 120.
check_gain_time:60
# The default is 20 seconds for extruders
#   and 60 seconds for heater_bed.
hysteresis: 5
#    The default is 5.
heating_gain: 2
#    The default is 2.

#####################################################################
#   Fan Control
#####################################################################
##  Controller fan - FAN2
[controller_fan Octopus_fan]
pin: PD14
kick_start_time: 0.5
heater: heater_bed

##  Exhaust fan - FAN3
[fan_generic Exhaust_Fan]
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 0.5

#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting - HE2 Connector (Optional)
[output_pin Chamber_LED]
pin: PD15
pwm:true
shutdown_value: 0
value:0.75
cycle_time: 0.01

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################
[idle_timeout]
timeout: 1800

[quad_gantry_level]
gantry_corners:
	-60,-10
	360,370
##	Probe points
points:
	50,25
	50,225
	250,225
	250,25
speed: 600
horizontal_move_z: 10
retries: 10
retry_tolerance: 0.0075
max_adjust: 10

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 54.137
#*# pid_ki = 2.472
#*# pid_kd = 296.400
#*#
#*# [probe]
#*# z_offset = -0.410
#*#
#*# [input_shaper]
#*# shaper_type_x = ei
#*# shaper_freq_x = 60.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 39.4
#*#
#*# [beacon model default]
#*# model_coef = 1.7756842564643547,
#*# 	2.0383602309658544,
#*# 	0.6047674354552829,
#*# 	0.30858278218480983,
#*# 	0.24740427348977845,
#*# 	-0.04350403955376604,
#*# 	-0.13226724908767137,
#*# 	0.14272135982543963,
#*# 	0.10619338638776032,
#*# 	-0.042497217575236466
#*# model_domain = 1.9090007618859247e-07,1.940089171082431e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 45.285838
#*# model_offset = 0.39000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.047702, -0.071408, -0.088458, -0.106698, -0.116863, -0.118391, -0.116359, -0.124247, -0.130915, -0.126473, -0.123373, -0.107131, -0.097065, -0.097948, -0.087813, -0.073721, -0.065799, -0.051191, -0.043751, -0.039832
#*# 	  -0.050902, -0.068419, -0.085869, -0.099808, -0.111712, -0.118628, -0.120873, -0.124674, -0.127754, -0.127762, -0.122927, -0.113517, -0.104944, -0.097247, -0.089093, -0.080131, -0.069675, -0.061937, -0.056314, -0.049067
#*# 	  -0.065037, -0.077549, -0.089701, -0.102120, -0.115091, -0.123788, -0.128492, -0.132203, -0.136264, -0.135399, -0.133424, -0.121436, -0.114019, -0.106629, -0.099924, -0.090763, -0.078778, -0.071549, -0.065622, -0.052234
#*# 	  -0.062828, -0.070669, -0.081255, -0.095207, -0.109407, -0.117415, -0.124165, -0.128849, -0.128820, -0.129811, -0.126475, -0.119778, -0.114189, -0.105876, -0.099239, -0.090239, -0.082190, -0.071851, -0.062706, -0.048282
#*# 	  -0.062524, -0.067344, -0.077976, -0.097193, -0.114475, -0.123206, -0.128466, -0.132952, -0.136870, -0.137211, -0.134321, -0.129861, -0.124345, -0.117232, -0.108518, -0.101101, -0.095590, -0.086999, -0.077802, -0.059968
#*# 	  -0.062436, -0.057248, -0.070497, -0.102141, -0.125313, -0.136311, -0.141048, -0.144987, -0.148373, -0.149554, -0.147192, -0.144249, -0.137392, -0.127643, -0.119488, -0.114786, -0.109452, -0.103116, -0.093199, -0.080526
#*# 	  -0.049000, -0.028575, -0.046537, -0.091931, -0.123511, -0.136552, -0.140157, -0.144699, -0.147175, -0.147336, -0.147542, -0.142375, -0.136074, -0.127598, -0.120381, -0.117021, -0.110239, -0.102926, -0.095795, -0.087781
#*# 	  -0.043314, -0.029586, -0.046855, -0.089835, -0.118296, -0.131602, -0.135513, -0.139527, -0.142254, -0.143636, -0.142061, -0.137554, -0.132740, -0.127591, -0.119113, -0.112191, -0.105875, -0.099350, -0.091609, -0.084161
#*# 	  -0.054070, -0.053107, -0.068423, -0.095979, -0.118544, -0.128100, -0.131853, -0.134474, -0.136785, -0.138197, -0.136810, -0.134486, -0.129217, -0.123500, -0.116663, -0.109360, -0.100748, -0.097277, -0.091704, -0.080789
#*# 	  -0.062249, -0.068769, -0.083170, -0.099610, -0.115109, -0.124313, -0.128807, -0.132370, -0.132882, -0.132817, -0.132096, -0.128955, -0.127710, -0.122896, -0.115893, -0.108000, -0.101637, -0.095941, -0.089595, -0.080627
#*# 	  -0.062334, -0.075281, -0.088692, -0.100152, -0.110113, -0.119373, -0.125394, -0.127493, -0.127730, -0.127164, -0.127766, -0.123539, -0.123247, -0.120830, -0.114611, -0.106989, -0.101271, -0.095369, -0.086769, -0.078681
#*# 	  -0.062916, -0.075437, -0.088323, -0.098587, -0.108900, -0.116855, -0.121622, -0.124950, -0.123292, -0.123301, -0.123250, -0.121711, -0.119635, -0.118194, -0.109589, -0.104139, -0.098885, -0.091633, -0.085112, -0.076122
#*# 	  -0.062334, -0.073439, -0.084762, -0.093645, -0.105051, -0.109991, -0.116767, -0.118783, -0.118779, -0.118547, -0.118295, -0.117875, -0.116320, -0.112070, -0.105311, -0.099725, -0.094492, -0.087037, -0.082189, -0.070430
#*# 	  -0.066319, -0.076328, -0.086390, -0.097508, -0.105918, -0.113501, -0.118075, -0.118881, -0.119117, -0.119431, -0.119190, -0.118709, -0.116315, -0.114254, -0.106204, -0.100173, -0.094677, -0.085342, -0.080850, -0.071784
#*# 	  -0.071148, -0.080332, -0.089787, -0.100603, -0.109719, -0.114001, -0.116712, -0.119110, -0.121930, -0.119408, -0.119928, -0.118459, -0.115536, -0.112100, -0.105564, -0.099905, -0.094052, -0.086455, -0.079555, -0.071212
#*# 	  -0.066465, -0.076077, -0.084635, -0.095729, -0.104817, -0.109437, -0.110269, -0.114006, -0.114557, -0.111605, -0.109703, -0.108425, -0.105373, -0.100559, -0.092217, -0.084551, -0.080559, -0.076536, -0.071021, -0.061527
#*# 	  -0.056546, -0.065755, -0.076180, -0.084892, -0.091358, -0.096582, -0.100239, -0.100969, -0.101861, -0.099524, -0.100773, -0.096751, -0.093354, -0.084731, -0.074548, -0.066616, -0.067268, -0.062605, -0.053629, -0.043990
#*# 	  -0.045406, -0.054715, -0.063979, -0.072479, -0.080563, -0.085582, -0.089054, -0.091368, -0.090072, -0.089913, -0.088582, -0.086555, -0.081043, -0.071820, -0.065580, -0.059436, -0.055885, -0.048504, -0.039712, -0.029027
#*# 	  -0.036512, -0.044453, -0.052902, -0.062340, -0.071250, -0.076890, -0.082513, -0.081919, -0.080634, -0.080370, -0.080728, -0.075882, -0.070181, -0.062771, -0.057398, -0.052820, -0.048621, -0.039183, -0.028501, -0.016971
#*# 	  -0.027367, -0.039162, -0.046645, -0.055117, -0.064101, -0.071076, -0.075695, -0.075949, -0.075829, -0.075339, -0.075425, -0.071283, -0.064356, -0.056497, -0.052093, -0.049655, -0.045271, -0.037308, -0.022213, -0.010799
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 1
#*# mesh_y_pps = 1
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 250.0
#*# min_y = 30.0
#*# max_y = 250.0
