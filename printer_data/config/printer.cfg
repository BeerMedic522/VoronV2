
[include shell_command.cfg]
# This file contains common pin mappings for the BigTreeTech Octopus V1.
# To use this config, the firmware should be compiled for the STM32F446 with a "32KiB bootloader"
# Enable "extra low-level configuration options" and select the "12MHz crystal" as clock reference

# after running "make", copy the generated "klipper/out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the OctoPus with that SD card.

# See docs/Config_Reference.md for a description of parameters.

## Voron Design VORON2 250/300/350mm BigTreeTech OctoPus V1 TMC2209 UART config

[include mainsail.cfg]
[include homing.cfg]
[include bed_mesh.cfg]
[include stealthburner_leds.cfg]
[include KAMP_Settings.cfg]
[include canbus.cfg]
[include bedfans.cfg]
[include macros.cfg]
[include beacon.cfg]

[exclude_object]

[force_move]
enable_force_move: True

[mcu]
canbus_uuid: 993242c5d629

[printer]
kinematics: corexy
max_velocity: 500  
max_accel:7000              #Max 4000
max_z_velocity: 50          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 300
square_corner_velocity: 5.0

#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to MOTOR_0
##  Endstop connected to DIAG_0
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_x:virtual_endstop
#position_min: 0


##  Uncomment for 300mm build
position_endstop: 306
position_max: 306
homing_speed: 40   #Max 100
homing_retract_dist: 0
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_x]
uart_pin: PC4
interpolate: false
run_current: 1.0
sense_resistor: 0.110
diag_pin: ^PG6
driver_SGTHRS: 135 # 255 is most sensitive value, 0 is least sensitive
stealthchop_threshold:0 #always on, 0 is off

##  A Stepper - Right
##  Connected to MOTOR_1
##  Endstop connected to DIAG_1
[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_y:virtual_endstop
#position_min: 0


##  Uncomment for 300mm build
position_endstop: 314
position_max: 314
homing_speed: 40  #Max 100
homing_retract_dist: 0.5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_y]
uart_pin: PD11
interpolate: false
run_current: 1.0
sense_resistor: 0.110
diag_pin: ^PG9
driver_SGTHRS: 142 # 255 is most sensitive value, 0 is least sensitive
stealthchop_threshold:0 #always on, 0 is off
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to MOTOR_2
##  Endstop connected to DIAG_2
[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16
endstop_pin: probe:z_virtual_endstop # use beacon as virtual endstop
homing_retract_dist: 0 # beacon needs this to be set to 0 
#position_endstop: -0.5


##--------------------------------------------------------------------
##  Uncomment below for 300mm build
position_max: 260
position_min: -5
homing_speed: 20
second_homing_speed: 3
homing_retract_dist: 3

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z]
uart_pin: PC6
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Left
##  Connected to MOTOR_3
[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Rear Right
##  Connected to MOTOR_4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z3 Stepper - Front Right
##  Connected to MOTOR_5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
#   Bed Heater
#####################################################################
[heater_bed]
heater_pin: PA1
sensor_type: Generic 3950
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.85
min_temp: 0
max_temp: 125
[verify_heater heater_bed]
max_error: 120
# The default is 120.
check_gain_time:60
# The default is 20 seconds for extruders
#   and 60 seconds for heater_bed.
hysteresis: 5
#    The default is 5.
heating_gain: 2
#    The default is 2.

#####################################################################
#   Fan Control
#####################################################################
##  Controller fan - FAN2
[controller_fan Octopus_fan]
pin: PD14
kick_start_time: 0.5
heater: heater_bed

##  Exhaust fan - FAN3
[fan_generic Exhaust_Fan]
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 0.5

#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting - HE2 Connector (Optional)
[output_pin Chamber_LED]
pin: PD15
pwm:true
shutdown_value: 0
value:0.75
cycle_time: 0.01

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################
[idle_timeout]
timeout: 3600

[quad_gantry_level]
##	Gantry Corners for 300mm Build
##	Uncomment for 300mm build
gantry_corners:
	-60,-10
	360,370
##	Probe points
points:
	50, 50
	50,250
	250,250
	250,50
speed: 600
horizontal_move_z: 7
retries: 10
retry_tolerance: 0.0075
max_adjust: 10

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 54.137
#*# pid_ki = 2.472
#*# pid_kd = 296.400
#*#
#*# [probe]
#*# z_offset = -0.410
#*#
#*# [input_shaper]
#*# shaper_type_x = ei
#*# shaper_freq_x = 60.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 39.4
#*#
#*# [beacon model default]
#*# model_coef = 1.6821974382560962,
#*# 	1.9917962996558078,
#*# 	0.6913485089883024,
#*# 	0.3115522861462093,
#*# 	0.2371728484449526,
#*# 	0.05197939133821482,
#*# 	-0.144575691475959,
#*# 	0.0724001046915076,
#*# 	0.13516289317239216,
#*# 	-0.02469855784450343
#*# model_domain = 1.9138649514550069e-07,1.9422398255241177e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 67.147942
#*# model_offset = -0.05000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.270976, 0.256358, 0.242225, 0.227255, 0.216010, 0.205596, 0.196155, 0.191934, 0.192372, 0.192946, 0.188774, 0.188350, 0.191135, 0.200492, 0.209535, 0.225313, 0.239304, 0.248813, 0.254345, 0.255245, 0.260758, 0.269514, 0.277641, 0.288323, 0.268009
#*# 	  0.276181, 0.256895, 0.245029, 0.229698, 0.220361, 0.210435, 0.203499, 0.198080, 0.197905, 0.196991, 0.193010, 0.190653, 0.192679, 0.199606, 0.208405, 0.222173, 0.233855, 0.244659, 0.250630, 0.255472, 0.263336, 0.272972, 0.282694, 0.290045, 0.272437
#*# 	  0.283482, 0.265423, 0.252816, 0.241404, 0.230385, 0.221948, 0.211826, 0.206369, 0.204177, 0.201435, 0.198725, 0.197859, 0.197985, 0.205253, 0.211962, 0.221218, 0.231240, 0.242511, 0.249726, 0.258178, 0.265857, 0.275565, 0.285036, 0.291361, 0.275470
#*# 	  0.293406, 0.276154, 0.263874, 0.253331, 0.242804, 0.232025, 0.221869, 0.215779, 0.210304, 0.208235, 0.205489, 0.204520, 0.208213, 0.212281, 0.218413, 0.225692, 0.234572, 0.244260, 0.253826, 0.264679, 0.274944, 0.282697, 0.293095, 0.300885, 0.284185
#*# 	  0.299902, 0.283698, 0.271651, 0.259382, 0.250511, 0.239381, 0.229967, 0.221906, 0.217717, 0.212052, 0.210501, 0.210580, 0.212314, 0.217749, 0.221143, 0.228119, 0.236057, 0.244352, 0.254408, 0.264646, 0.276770, 0.286785, 0.295563, 0.304290, 0.289318
#*# 	  0.298496, 0.284909, 0.272191, 0.261432, 0.251776, 0.239652, 0.228998, 0.223509, 0.218575, 0.212373, 0.210143, 0.208380, 0.209423, 0.213213, 0.217940, 0.226372, 0.234177, 0.242830, 0.250796, 0.260699, 0.272362, 0.284825, 0.296286, 0.302818, 0.289221
#*# 	  0.300303, 0.286204, 0.274418, 0.262622, 0.252126, 0.238970, 0.229697, 0.223552, 0.216412, 0.212315, 0.207465, 0.206648, 0.207372, 0.211086, 0.217894, 0.225008, 0.235815, 0.240835, 0.248344, 0.256560, 0.268559, 0.280195, 0.291741, 0.302511, 0.289531
#*# 	  0.303844, 0.290723, 0.279674, 0.267592, 0.255044, 0.241902, 0.231019, 0.224773, 0.218080, 0.212925, 0.209736, 0.208555, 0.209264, 0.214055, 0.216260, 0.228418, 0.238778, 0.247183, 0.252256, 0.259510, 0.274655, 0.282545, 0.296218, 0.304172, 0.292819
#*# 	  0.308403, 0.294345, 0.283319, 0.272961, 0.258272, 0.245668, 0.232376, 0.223729, 0.219359, 0.215240, 0.210825, 0.210298, 0.210234, 0.214898, 0.220278, 0.228502, 0.240901, 0.248694, 0.257373, 0.266761, 0.280237, 0.290990, 0.301781, 0.309568, 0.298300
#*# 	  0.311120, 0.298450, 0.286542, 0.273181, 0.259561, 0.246740, 0.234204, 0.225408, 0.221751, 0.217785, 0.213896, 0.212965, 0.214304, 0.219600, 0.225654, 0.232002, 0.243330, 0.252188, 0.259772, 0.271036, 0.282673, 0.293546, 0.305003, 0.315627, 0.302285
#*# 	  0.308714, 0.295098, 0.282841, 0.270405, 0.255467, 0.242881, 0.231499, 0.220282, 0.216311, 0.216224, 0.214217, 0.213159, 0.212519, 0.217481, 0.223900, 0.233412, 0.243317, 0.253361, 0.263873, 0.275644, 0.286913, 0.295992, 0.306989, 0.316720, 0.304569
#*# 	  0.308660, 0.295182, 0.281083, 0.267761, 0.256229, 0.246115, 0.234179, 0.224233, 0.219680, 0.219569, 0.217126, 0.216077, 0.215796, 0.219627, 0.224069, 0.234464, 0.245253, 0.254665, 0.265485, 0.276286, 0.289537, 0.297385, 0.309078, 0.317744, 0.305509
#*# 	  0.309362, 0.296603, 0.282130, 0.270135, 0.259041, 0.250073, 0.239421, 0.229482, 0.223818, 0.223603, 0.223535, 0.222345, 0.220195, 0.224017, 0.229538, 0.237787, 0.247484, 0.257033, 0.266959, 0.276549, 0.288254, 0.298881, 0.310787, 0.317906, 0.305943
#*# 	  0.305862, 0.297269, 0.282165, 0.270657, 0.258795, 0.250514, 0.241974, 0.234704, 0.229186, 0.227643, 0.226852, 0.227090, 0.223801, 0.227555, 0.231331, 0.238081, 0.246588, 0.254601, 0.267240, 0.278067, 0.290730, 0.299064, 0.311667, 0.320391, 0.306582
#*# 	  0.302514, 0.292312, 0.279777, 0.269902, 0.259883, 0.251285, 0.244639, 0.237943, 0.234183, 0.231432, 0.228528, 0.228190, 0.228280, 0.229557, 0.232927, 0.237647, 0.245755, 0.256143, 0.266968, 0.278363, 0.288054, 0.299185, 0.310069, 0.318825, 0.305862
#*# 	  0.291637, 0.281713, 0.271852, 0.261047, 0.253109, 0.246595, 0.238956, 0.235430, 0.231207, 0.226098, 0.226555, 0.225897, 0.226143, 0.228679, 0.230395, 0.234624, 0.242347, 0.253518, 0.266071, 0.275646, 0.285605, 0.294925, 0.309057, 0.320022, 0.303400
#*# 	  0.285720, 0.278479, 0.266995, 0.257945, 0.251593, 0.240089, 0.235082, 0.231501, 0.228518, 0.224520, 0.221959, 0.222840, 0.222737, 0.224823, 0.226556, 0.230201, 0.240156, 0.251426, 0.261602, 0.271257, 0.279757, 0.289798, 0.302412, 0.312225, 0.297200
#*# 	  0.280099, 0.269923, 0.258970, 0.248792, 0.240299, 0.234548, 0.229606, 0.227376, 0.223864, 0.220757, 0.219025, 0.219337, 0.220324, 0.221245, 0.220982, 0.226940, 0.237432, 0.254439, 0.263334, 0.270561, 0.277053, 0.286022, 0.297724, 0.307910, 0.294610
#*# 	  0.277836, 0.264010, 0.256959, 0.248152, 0.237957, 0.232948, 0.232554, 0.225674, 0.223020, 0.221080, 0.219734, 0.218709, 0.217713, 0.218637, 0.220961, 0.226113, 0.239948, 0.253878, 0.262580, 0.267152, 0.273485, 0.282383, 0.295150, 0.306710, 0.293889
#*# 	  0.275792, 0.264496, 0.254451, 0.244044, 0.236228, 0.232545, 0.227939, 0.225066, 0.220365, 0.217595, 0.217799, 0.217878, 0.217053, 0.219064, 0.221341, 0.229038, 0.242102, 0.254340, 0.263351, 0.269100, 0.273733, 0.281682, 0.296611, 0.305346, 0.294532
#*# 	  0.276494, 0.265382, 0.255877, 0.246809, 0.238686, 0.231616, 0.228000, 0.223823, 0.220970, 0.221118, 0.217963, 0.217407, 0.217234, 0.218981, 0.224486, 0.231758, 0.241380, 0.252018, 0.260142, 0.266706, 0.275442, 0.286871, 0.300174, 0.310195, 0.297107
#*# 	  0.278054, 0.269089, 0.258954, 0.249908, 0.240545, 0.232957, 0.226636, 0.220687, 0.217120, 0.217083, 0.216968, 0.217317, 0.218482, 0.222572, 0.226839, 0.234020, 0.243491, 0.251657, 0.256649, 0.263639, 0.274041, 0.286898, 0.301397, 0.311165, 0.295830
#*# 	  0.274646, 0.266846, 0.257532, 0.248597, 0.238083, 0.228243, 0.220264, 0.214914, 0.211272, 0.209162, 0.209435, 0.209451, 0.213101, 0.217057, 0.222565, 0.228565, 0.240196, 0.246615, 0.254376, 0.260463, 0.271301, 0.283876, 0.295213, 0.306261, 0.295048
#*# 	  0.249983, 0.239665, 0.229094, 0.219790, 0.209775, 0.201507, 0.190778, 0.185676, 0.180347, 0.178910, 0.178151, 0.181836, 0.182300, 0.188084, 0.193130, 0.201222, 0.211060, 0.220097, 0.224284, 0.235307, 0.247232, 0.259705, 0.271791, 0.281392, 0.275362
#*# 	  -0.523987, -0.533285, -0.533937, -0.552911, -0.569824, -0.553765, -0.555827, -0.559037, -0.558411, -0.553629, -0.550221, -0.537415, -0.533377, -0.525707, -0.516408, -0.503259, -0.490686, -0.485737, -0.491213, -0.457603, -0.404590, -0.382389, -0.371610, -0.383054, -0.398702
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 270.0
#*# min_y = 20.0
#*# max_y = 270.0
