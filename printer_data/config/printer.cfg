

[include shell_command.cfg]
# This file contains common pin mappings for the BigTreeTech Octopus V1.
# To use this config, the firmware should be compiled for the STM32F446 with a "32KiB bootloader"
# Enable "extra low-level configuration options" and select the "12MHz crystal" as clock reference

# after running "make", copy the generated "klipper/out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the OctoPus with that SD card.

# See docs/Config_Reference.md for a description of parameters.

## Voron Design VORON2 250/300/350mm BigTreeTech OctoPus V1 TMC2209 UART config

[include mainsail.cfg]
[include homing.cfg]
[include bed_mesh.cfg]
[include stealthburner_leds.cfg]
[include KAMP_Settings.cfg]
[include canbus.cfg]
[include bedfans.cfg]
[include macros.cfg]
[include beacon.cfg]

[exclude_object]

[force_move]
enable_force_move: True
[pause_resume]

[mcu]
canbus_uuid: 993242c5d629

[printer]
kinematics: corexy
max_velocity: 500  
max_accel:7000              #Max 4000
max_z_velocity: 50          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 300
square_corner_velocity: 5.0

#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to MOTOR_0
##  Endstop connected to DIAG_0
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_x:virtual_endstop
#position_min: 0


##  Uncomment for 300mm build
position_endstop: 306
position_max: 306
homing_speed: 40   #Max 100
homing_retract_dist: 0
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_x]
uart_pin: PC4
interpolate: false
run_current: 1.0
sense_resistor: 0.110
diag_pin: ^PG6
driver_SGTHRS: 135 # 255 is most sensitive value, 0 is least sensitive
stealthchop_threshold:0 #always on, 0 is off

##  A Stepper - Right
##  Connected to MOTOR_1
##  Endstop connected to DIAG_1
[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_y:virtual_endstop
#position_min: 0


##  Uncomment for 300mm build
position_endstop: 314
position_max: 314
homing_speed: 40  #Max 100
homing_retract_dist: 0.5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_y]
uart_pin: PD11
interpolate: false
run_current: 1.0
sense_resistor: 0.110
diag_pin: ^PG9
driver_SGTHRS: 142 # 255 is most sensitive value, 0 is least sensitive
stealthchop_threshold:0 #always on, 0 is off
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to MOTOR_2
##  Endstop connected to DIAG_2
[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16
endstop_pin: probe:z_virtual_endstop # use beacon as virtual endstop
homing_retract_dist: 0 # beacon needs this to be set to 0 
#position_endstop: -0.5


##--------------------------------------------------------------------
##  Uncomment below for 300mm build
position_max: 260
position_min: -5
homing_speed: 20
second_homing_speed: 3
homing_retract_dist: 3

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z]
uart_pin: PC6
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Left
##  Connected to MOTOR_3
[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Rear Right
##  Connected to MOTOR_4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z3 Stepper - Front Right
##  Connected to MOTOR_5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
#   Bed Heater
#####################################################################
[heater_bed]
heater_pin: PA1
sensor_type: Generic 3950
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.85
min_temp: 0
max_temp: 125
[verify_heater heater_bed]
max_error: 120
# The default is 120.
check_gain_time:60
# The default is 20 seconds for extruders
#   and 60 seconds for heater_bed.
hysteresis: 5
#    The default is 5.
heating_gain: 2
#    The default is 2.

#####################################################################
#   Fan Control
#####################################################################
##  Controller fan - FAN2
[controller_fan Octopus_fan]
pin: PD14
kick_start_time: 0.5
heater: heater_bed

##  Exhaust fan - FAN3
[fan_generic Exhaust_Fan]
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 0.5

#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting - HE2 Connector (Optional)
[output_pin Chamber_LED]
pin: PD15
pwm:true
shutdown_value: 0
value:0.75
cycle_time: 0.01

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################
[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Gantry Corners for 300mm Build
##	Uncomment for 300mm build
gantry_corners:
	-60,-10
	360,370
##	Probe points
points:
	30, 30
	30,270
	270,270
	270,30
speed: 600
horizontal_move_z: 7
retries: 10
retry_tolerance: 0.0075
max_adjust: 10

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 54.137
#*# pid_ki = 2.472
#*# pid_kd = 296.400
#*#
#*# [probe]
#*# z_offset = -0.410
#*#
#*# [input_shaper]
#*# shaper_type_x = ei
#*# shaper_freq_x = 60.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 39.4
#*#
#*# [beacon model default]
#*# model_coef = 1.6821974382560962,
#*# 	1.9917962996558078,
#*# 	0.6913485089883024,
#*# 	0.3115522861462093,
#*# 	0.2371728484449526,
#*# 	0.05197939133821482,
#*# 	-0.144575691475959,
#*# 	0.0724001046915076,
#*# 	0.13516289317239216,
#*# 	-0.02469855784450343
#*# model_domain = 1.9138649514550069e-07,1.9422398255241177e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 67.147942
#*# model_offset = -0.49000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.261479, -0.271874, -0.284015, -0.297900, -0.311530, -0.324097, -0.331319, -0.335169, -0.337252, -0.337549, -0.338193, -0.335217, -0.331021, -0.325730, -0.318615, -0.306820, -0.295835, -0.285653, -0.280174, -0.275848, -0.270893, -0.263161, -0.255165, -0.246696, -0.263535
#*# 	  -0.238324, -0.248361, -0.260119, -0.273464, -0.286719, -0.298216, -0.305421, -0.310166, -0.314210, -0.316115, -0.318001, -0.314548, -0.311740, -0.307456, -0.298487, -0.289784, -0.280785, -0.270869, -0.265414, -0.260127, -0.256006, -0.251598, -0.247224, -0.239179, -0.258711
#*# 	  -0.211502, -0.224554, -0.236178, -0.245970, -0.259833, -0.271944, -0.280902, -0.289054, -0.293799, -0.293763, -0.295038, -0.294497, -0.292918, -0.287594, -0.283040, -0.274109, -0.264210, -0.257931, -0.250413, -0.243406, -0.239042, -0.233914, -0.231482, -0.226578, -0.246800
#*# 	  -0.180531, -0.190913, -0.202278, -0.212275, -0.223690, -0.235632, -0.246216, -0.254963, -0.261726, -0.267498, -0.270418, -0.270432, -0.267445, -0.263355, -0.259566, -0.251514, -0.243866, -0.237786, -0.230125, -0.221767, -0.217786, -0.214130, -0.210097, -0.207936, -0.227764
#*# 	  -0.153377, -0.164765, -0.175993, -0.184409, -0.194710, -0.206151, -0.220264, -0.228586, -0.239883, -0.244912, -0.247889, -0.248416, -0.247779, -0.242205, -0.234477, -0.227396, -0.221864, -0.216240, -0.208819, -0.203367, -0.199997, -0.197495, -0.193816, -0.192425, -0.212489
#*# 	  -0.135772, -0.147241, -0.157273, -0.167249, -0.178505, -0.189932, -0.200454, -0.208405, -0.216273, -0.224462, -0.229939, -0.232291, -0.231930, -0.228032, -0.223959, -0.220404, -0.215267, -0.210076, -0.203321, -0.200050, -0.197771, -0.195534, -0.191784, -0.190055, -0.210002
#*# 	  -0.120418, -0.127846, -0.140817, -0.151413, -0.163516, -0.174268, -0.186066, -0.195223, -0.202072, -0.209084, -0.214659, -0.220360, -0.220685, -0.219792, -0.216192, -0.211844, -0.209381, -0.204963, -0.201569, -0.196663, -0.193240, -0.191655, -0.188289, -0.183729, -0.206331
#*# 	  -0.097011, -0.108070, -0.117793, -0.131612, -0.143230, -0.156036, -0.168058, -0.175836, -0.184350, -0.191454, -0.198366, -0.201229, -0.202403, -0.203206, -0.201753, -0.198047, -0.195760, -0.193391, -0.190647, -0.189049, -0.185232, -0.183882, -0.179657, -0.177452, -0.199457
#*# 	  -0.070059, -0.079355, -0.090640, -0.102789, -0.116749, -0.131126, -0.144405, -0.155169, -0.166220, -0.173133, -0.181188, -0.183440, -0.185533, -0.184168, -0.183255, -0.181841, -0.179736, -0.177911, -0.175167, -0.173026, -0.171492, -0.171368, -0.167730, -0.167314, -0.186986
#*# 	  -0.039085, -0.049005, -0.060519, -0.075476, -0.090617, -0.106735, -0.120524, -0.132786, -0.142043, -0.151352, -0.158590, -0.162523, -0.164221, -0.162812, -0.162932, -0.160882, -0.159472, -0.154064, -0.149397, -0.149986, -0.149735, -0.152056, -0.148714, -0.149679, -0.170906
#*# 	  -0.012590, -0.027148, -0.037654, -0.053980, -0.067196, -0.084754, -0.098512, -0.109334, -0.121728, -0.130476, -0.136782, -0.138496, -0.144054, -0.145496, -0.147508, -0.147277, -0.145136, -0.139784, -0.136686, -0.132728, -0.135077, -0.135378, -0.135200, -0.135526, -0.158613
#*# 	  0.014850, 0.001771, -0.013527, -0.029225, -0.044325, -0.058458, -0.073963, -0.085542, -0.096693, -0.105747, -0.110606, -0.114808, -0.120425, -0.125638, -0.128481, -0.129099, -0.126900, -0.122454, -0.120290, -0.120032, -0.117506, -0.121771, -0.122045, -0.122672, -0.142364
#*# 	  0.040253, 0.026094, 0.011823, -0.002790, -0.021303, -0.034966, -0.048955, -0.060655, -0.071736, -0.077315, -0.082394, -0.088288, -0.093695, -0.099953, -0.105203, -0.105874, -0.105702, -0.104367, -0.103160, -0.102625, -0.102867, -0.105500, -0.105576, -0.106992, -0.131520
#*# 	  0.066748, 0.056625, 0.043276, 0.026559, 0.007738, -0.008086, -0.023973, -0.035660, -0.046015, -0.053394, -0.059724, -0.064713, -0.072647, -0.078182, -0.082672, -0.085881, -0.086405, -0.085781, -0.086033, -0.086581, -0.087035, -0.089953, -0.090332, -0.092439, -0.115638
#*# 	  0.099297, 0.089531, 0.078059, 0.062382, 0.043315, 0.023408, 0.007430, -0.006857, -0.014978, -0.022307, -0.029800, -0.034894, -0.041764, -0.045836, -0.052671, -0.054758, -0.056326, -0.058330, -0.059728, -0.062396, -0.063479, -0.067214, -0.067329, -0.069435, -0.094407
#*# 	  0.129615, 0.117890, 0.108299, 0.091037, 0.072381, 0.053442, 0.037973, 0.025388, 0.016781, 0.007746, 0.001076, -0.004127, -0.010181, -0.016321, -0.022947, -0.027027, -0.029824, -0.031410, -0.033430, -0.037409, -0.040756, -0.044201, -0.044901, -0.046197, -0.070896
#*# 	  0.152136, 0.142057, 0.126967, 0.111452, 0.093543, 0.077517, 0.064672, 0.050457, 0.040776, 0.030637, 0.024930, 0.017699, 0.013196, 0.006846, -0.000424, -0.007058, -0.009540, -0.011644, -0.013774, -0.018279, -0.020503, -0.023919, -0.026025, -0.027993, -0.055383
#*# 	  0.170708, 0.156559, 0.144097, 0.127511, 0.110366, 0.096115, 0.083463, 0.070208, 0.056182, 0.048099, 0.040806, 0.033654, 0.026775, 0.021988, 0.015221, 0.012035, 0.008766, 0.006648, 0.001374, -0.003305, -0.006987, -0.009866, -0.011917, -0.014174, -0.039255
#*# 	  0.195629, 0.181849, 0.167046, 0.151274, 0.135605, 0.119800, 0.107539, 0.094325, 0.080232, 0.070804, 0.061520, 0.052816, 0.045286, 0.039801, 0.038092, 0.035060, 0.032750, 0.029099, 0.025288, 0.017301, 0.013025, 0.009522, 0.007831, 0.006228, -0.020599
#*# 	  0.225766, 0.210850, 0.195580, 0.177789, 0.162963, 0.147853, 0.132297, 0.118885, 0.107003, 0.096785, 0.086191, 0.078335, 0.069060, 0.063809, 0.062216, 0.061995, 0.059866, 0.055915, 0.050347, 0.043409, 0.038171, 0.035505, 0.033040, 0.031728, 0.006121
#*# 	  0.261175, 0.244710, 0.228693, 0.211926, 0.195320, 0.180828, 0.166120, 0.152563, 0.143020, 0.129623, 0.118733, 0.108675, 0.097998, 0.092407, 0.090182, 0.090061, 0.087288, 0.083396, 0.077537, 0.072228, 0.069405, 0.068638, 0.067265, 0.064459, 0.037387
#*# 	  0.296232, 0.282377, 0.263853, 0.247205, 0.230980, 0.214450, 0.198166, 0.184923, 0.173024, 0.159917, 0.149787, 0.140374, 0.128462, 0.123391, 0.119325, 0.117027, 0.114481, 0.112262, 0.108848, 0.107683, 0.108020, 0.108814, 0.108820, 0.104168, 0.070015
#*# 	  0.326860, 0.310200, 0.294315, 0.277447, 0.261176, 0.243603, 0.229220, 0.214867, 0.201566, 0.189137, 0.177945, 0.168923, 0.160160, 0.152879, 0.147639, 0.144513, 0.143494, 0.145158, 0.150567, 0.157821, 0.164048, 0.167540, 0.166024, 0.157786, 0.116654
#*# 	  0.345310, 0.327341, 0.310023, 0.289654, 0.272734, 0.256763, 0.242690, 0.227592, 0.213602, 0.202719, 0.189324, 0.179683, 0.169893, 0.163882, 0.158816, 0.158296, 0.160992, 0.170997, 0.188476, 0.211428, 0.229904, 0.238827, 0.235480, 0.218018, 0.170203
#*# 	  -0.279929, -0.297543, -0.319074, -0.351122, -0.383329, -0.368561, -0.380552, -0.398160, -0.407531, -0.419440, -0.434903, -0.443876, -0.450208, -0.448098, -0.447469, -0.444630, -0.433344, -0.412060, -0.389400, -0.329567, -0.272702, -0.251895, -0.258724, -0.289654, -0.344700
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 270.0
#*# min_y = 20.0
#*# max_y = 270.0
