

[include shell_command.cfg]
# This file contains common pin mappings for the BigTreeTech Octopus V1.
# To use this config, the firmware should be compiled for the STM32F446 with a "32KiB bootloader"
# Enable "extra low-level configuration options" and select the "12MHz crystal" as clock reference

# after running "make", copy the generated "klipper/out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the OctoPus with that SD card.

# See docs/Config_Reference.md for a description of parameters.

## Voron Design VORON2 250/300/350mm BigTreeTech OctoPus V1 TMC2209 UART config

[include mainsail.cfg]
[include homing.cfg]
[include bed_mesh.cfg]
[include stealthburner_leds.cfg]
[include KAMP_Settings.cfg]
[include canbus.cfg]
[include bedfans.cfg]
[include macros.cfg]
[include beacon.cfg]

[exclude_object]

[force_move]
enable_force_move: True
[pause_resume]

[mcu]
canbus_uuid: 993242c5d629

[printer]
kinematics: corexy
max_velocity: 500  
max_accel:7000              #Max 4000
max_z_velocity: 50          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 300
square_corner_velocity: 5.0

#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to MOTOR_0
##  Endstop connected to DIAG_0
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_x:virtual_endstop
#position_min: 0


##  Uncomment for 300mm build
position_endstop: 306
position_max: 306
homing_speed: 40   #Max 100
homing_retract_dist: 0
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_x]
uart_pin: PC4
interpolate: false
run_current: 1.0
sense_resistor: 0.110
diag_pin: ^PG6
driver_SGTHRS: 135 # 255 is most sensitive value, 0 is least sensitive
stealthchop_threshold:0 #always on, 0 is off

##  A Stepper - Right
##  Connected to MOTOR_1
##  Endstop connected to DIAG_1
[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_y:virtual_endstop
#position_min: 0


##  Uncomment for 300mm build
position_endstop: 314
position_max: 314
homing_speed: 40  #Max 100
homing_retract_dist: 0.5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_y]
uart_pin: PD11
interpolate: false
run_current: 1.0
sense_resistor: 0.110
diag_pin: ^PG9
driver_SGTHRS: 142 # 255 is most sensitive value, 0 is least sensitive
stealthchop_threshold:0 #always on, 0 is off
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to MOTOR_2
##  Endstop connected to DIAG_2
[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16
endstop_pin: probe:z_virtual_endstop # use beacon as virtual endstop
homing_retract_dist: 0 # beacon needs this to be set to 0 
#position_endstop: -0.5


##--------------------------------------------------------------------
##  Uncomment below for 300mm build
position_max: 260
position_min: -5
homing_speed: 20
second_homing_speed: 3
homing_retract_dist: 3

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z]
uart_pin: PC6
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Left
##  Connected to MOTOR_3
[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Rear Right
##  Connected to MOTOR_4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z3 Stepper - Front Right
##  Connected to MOTOR_5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
#   Bed Heater
#####################################################################
[heater_bed]
heater_pin: PA1
sensor_type: Generic 3950
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.85
min_temp: 0
max_temp: 125
[verify_heater heater_bed]
max_error: 120
# The default is 120.
check_gain_time:60
# The default is 20 seconds for extruders
#   and 60 seconds for heater_bed.
hysteresis: 5
#    The default is 5.
heating_gain: 2
#    The default is 2.

#####################################################################
#   Fan Control
#####################################################################
##  Controller fan - FAN2
[controller_fan Octopus_fan]
pin: PD14
kick_start_time: 0.5
heater: heater_bed

##  Exhaust fan - FAN3
[fan_generic Exhaust_Fan]
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 0.5

#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting - HE2 Connector (Optional)
[output_pin Chamber_LED]
pin: PD15
pwm:true
shutdown_value: 0
value:0.75
cycle_time: 0.01

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################
[idle_timeout]
timeout: 1800

[quad_gantry_level]
##	Gantry Corners for 300mm Build
##	Uncomment for 300mm build
gantry_corners:
	-60,-10
	360,370
##	Probe points
points:
	30, 30
	30,270
	270,270
	270,30
speed: 600
horizontal_move_z: 7
retries: 10
retry_tolerance: 0.0075
max_adjust: 10

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 54.137
#*# pid_ki = 2.472
#*# pid_kd = 296.400
#*#
#*# [probe]
#*# z_offset = -0.410
#*#
#*# [input_shaper]
#*# shaper_type_x = ei
#*# shaper_freq_x = 60.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 39.4
#*#
#*# [beacon model default]
#*# model_coef = 1.6821974382560962,
#*# 	  1.9917962996558078,
#*# 	  0.6913485089883024,
#*# 	  0.3115522861462093,
#*# 	  0.2371728484449526,
#*# 	  0.05197939133821482,
#*# 	  -0.144575691475959,
#*# 	  0.0724001046915076,
#*# 	  0.13516289317239216,
#*# 	  -0.02469855784450343
#*# model_domain = 1.9138649514550069e-07,1.9422398255241177e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 67.147942
#*# model_offset = -0.49500
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.206231, -0.219970, -0.231939, -0.242470, -0.253656, -0.261572, -0.267189, -0.271336, -0.275460, -0.276715, -0.275150, -0.273223, -0.267672, -0.260423, -0.251080, -0.243009, -0.235195, -0.227865, -0.223082, -0.216086, -0.207790, -0.201094, -0.192583, -0.186787, -0.206614
#*# 	-0.183249, -0.194536, -0.205857, -0.217149, -0.227341, -0.233951, -0.242469, -0.246511, -0.250583, -0.253391, -0.251933, -0.250791, -0.245387, -0.239996, -0.233127, -0.224948, -0.219638, -0.211567, -0.203881, -0.196511, -0.188908, -0.182616, -0.176379, -0.171173, -0.188352
#*# 	-0.157230, -0.168538, -0.179020, -0.187758, -0.198326, -0.207731, -0.214989, -0.220690, -0.224363, -0.228026, -0.227512, -0.225507, -0.221340, -0.219118, -0.214596, -0.206802, -0.200660, -0.194253, -0.186625, -0.179430, -0.170243, -0.163906, -0.157734, -0.152148, -0.172192
#*# 	-0.134677, -0.146170, -0.156681, -0.165717, -0.176108, -0.185961, -0.192810, -0.199866, -0.204263, -0.207282, -0.208410, -0.207675, -0.204401, -0.201963, -0.198457, -0.192251, -0.186091, -0.181292, -0.173307, -0.164855, -0.156030, -0.149939, -0.141509, -0.135470, -0.153233
#*# 	-0.113934, -0.124257, -0.134826, -0.144407, -0.155284, -0.163227, -0.171742, -0.178277, -0.183933, -0.188855, -0.190840, -0.191235, -0.188477, -0.185418, -0.181742, -0.177285, -0.171755, -0.165853, -0.159579, -0.153314, -0.143665, -0.133169, -0.125375, -0.120338, -0.136806
#*# 	-0.093115, -0.103219, -0.113956, -0.124792, -0.135966, -0.146635, -0.154360, -0.158674, -0.165693, -0.170209, -0.173334, -0.173711, -0.172200, -0.170571, -0.166352, -0.160508, -0.155428, -0.150668, -0.144958, -0.137141, -0.127000, -0.120100, -0.110007, -0.102825, -0.119172
#*# 	-0.063087, -0.073842, -0.085507, -0.097405, -0.111827, -0.123307, -0.129538, -0.136778, -0.141745, -0.146855, -0.150720, -0.151821, -0.150779, -0.146637, -0.142670, -0.137040, -0.130671, -0.126614, -0.120288, -0.112719, -0.102749, -0.095233, -0.085504, -0.079344, -0.094184
#*# 	-0.036316, -0.046050, -0.058771, -0.071441, -0.085106, -0.097832, -0.106310, -0.111737, -0.116670, -0.122970, -0.125628, -0.127409, -0.126386, -0.123343, -0.118310, -0.111961, -0.104882, -0.099504, -0.092836, -0.085301, -0.075670, -0.067446, -0.060967, -0.053836, -0.070895
#*# 	-0.010641, -0.021785, -0.033196, -0.047837, -0.061358, -0.073305, -0.081775, -0.087635, -0.092034, -0.096324, -0.099778, -0.102530, -0.100910, -0.097053, -0.092102, -0.085659, -0.078594, -0.072053, -0.066104, -0.057443, -0.049323, -0.044277, -0.034943, -0.029295, -0.047260
#*# 	0.011112, -0.000725, -0.013658, -0.026485, -0.038963, -0.050241, -0.058141, -0.064687, -0.067599, -0.070095, -0.076204, -0.078548, -0.077307, -0.074855, -0.067922, -0.061344, -0.055095, -0.049200, -0.042244, -0.036438, -0.027661, -0.022027, -0.013652, -0.008698, -0.026461
#*# 	0.037106, 0.024564, 0.012211, 0.000607, -0.009622, -0.021065, -0.030533, -0.035104, -0.038545, -0.041785, -0.045445, -0.047719, -0.049487, -0.045902, -0.039873, -0.034819, -0.027574, -0.023093, -0.016433, -0.010006, -0.002173, 0.003234, 0.010862, 0.016356, 0.000363
#*# 	0.063901, 0.052376, 0.040712, 0.030347, 0.020410, 0.010528, -0.000696, -0.004283, -0.008907, -0.009433, -0.014199, -0.019208, -0.020130, -0.018056, -0.012955, -0.009220, -0.002977, 0.001851, 0.007712, 0.014089, 0.021500, 0.026320, 0.033398, 0.038574, 0.019113
#*# 	0.091923, 0.081031, 0.069427, 0.060369, 0.049772, 0.039108, 0.031917, 0.025711, 0.021799, 0.019743, 0.016338, 0.010810, 0.009962, 0.010846, 0.013614, 0.015239, 0.021086, 0.025835, 0.031566, 0.038616, 0.044256, 0.050807, 0.058031, 0.061873, 0.044822
#*# 	0.120823, 0.110250, 0.099622, 0.089965, 0.081707, 0.071338, 0.064787, 0.058128, 0.054943, 0.050927, 0.046826, 0.043780, 0.040796, 0.039763, 0.041069, 0.043651, 0.047381, 0.052902, 0.060381, 0.065387, 0.070456, 0.076229, 0.081825, 0.085170, 0.063939
#*# 	0.144000, 0.134479, 0.122361, 0.113290, 0.104911, 0.096896, 0.090478, 0.085478, 0.080540, 0.076759, 0.071742, 0.068733, 0.067654, 0.065925, 0.066093, 0.067425, 0.072427, 0.078006, 0.083074, 0.088996, 0.092288, 0.097659, 0.104837, 0.107424, 0.086509
#*# 	0.168558, 0.159841, 0.147861, 0.138335, 0.129937, 0.121700, 0.115170, 0.110752, 0.106257, 0.102581, 0.099128, 0.095127, 0.094318, 0.091634, 0.090619, 0.092912, 0.098130, 0.103439, 0.106571, 0.110508, 0.115355, 0.119118, 0.125330, 0.128452, 0.108591
#*# 	0.194060, 0.183166, 0.172634, 0.163803, 0.154926, 0.148270, 0.141140, 0.136822, 0.131573, 0.128533, 0.125263, 0.123159, 0.120725, 0.117418, 0.117625, 0.118970, 0.124585, 0.128577, 0.133035, 0.135203, 0.138536, 0.142376, 0.148217, 0.153566, 0.131892
#*# 	0.224915, 0.212680, 0.201181, 0.192361, 0.185139, 0.179100, 0.172427, 0.166651, 0.162137, 0.158941, 0.156558, 0.154936, 0.150809, 0.147675, 0.148033, 0.150393, 0.156449, 0.159943, 0.163306, 0.164136, 0.166727, 0.169298, 0.177338, 0.180512, 0.160635
#*# 	0.258713, 0.246511, 0.234670, 0.224637, 0.218096, 0.211451, 0.206610, 0.201076, 0.197110, 0.193551, 0.190671, 0.187762, 0.184024, 0.181381, 0.181810, 0.185109, 0.190446, 0.193543, 0.196373, 0.196600, 0.198899, 0.202633, 0.209410, 0.213312, 0.195265
#*# 	0.294113, 0.281748, 0.269301, 0.260635, 0.252927, 0.246863, 0.240962, 0.235405, 0.230974, 0.227374, 0.224171, 0.219664, 0.215923, 0.214402, 0.214713, 0.219866, 0.223794, 0.226360, 0.226818, 0.227823, 0.231119, 0.234577, 0.241913, 0.245144, 0.225113
#*# 	0.331692, 0.318709, 0.308780, 0.299891, 0.292442, 0.285505, 0.276054, 0.271679, 0.267436, 0.263902, 0.258972, 0.254505, 0.252290, 0.251016, 0.252560, 0.254882, 0.257446, 0.258181, 0.258571, 0.258604, 0.262553, 0.268804, 0.275710, 0.279213, 0.259196
#*# 	0.370621, 0.357750, 0.347902, 0.338538, 0.331821, 0.321151, 0.312973, 0.306089, 0.301691, 0.297965, 0.294043, 0.289952, 0.288836, 0.286761, 0.288310, 0.289636, 0.292175, 0.291102, 0.290648, 0.292459, 0.295473, 0.302074, 0.308647, 0.311752, 0.293514
#*# 	0.403811, 0.393042, 0.381648, 0.372031, 0.363671, 0.353199, 0.344887, 0.337967, 0.332429, 0.328268, 0.324375, 0.320691, 0.318638, 0.318631, 0.319008, 0.321856, 0.323460, 0.322987, 0.321789, 0.321672, 0.327329, 0.331364, 0.337558, 0.340850, 0.323873
#*# 	0.299046, 0.288024, 0.275686, 0.263203, 0.257260, 0.249920, 0.241602, 0.234403, 0.230829, 0.225721, 0.220913, 0.218246, 0.217485, 0.217389, 0.220631, 0.222429, 0.225698, 0.225274, 0.223764, 0.227780, 0.237045, 0.243209, 0.245284, 0.247433, 0.238994
#*# x_count = 25
#*# y_count = 24
#*# mesh_x_pps = 2
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 29.79
#*# max_x = 270.0
#*# min_y = 34.542
#*# max_y = 265.408
