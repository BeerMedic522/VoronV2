

[include shell_command.cfg]
# This file contains common pin mappings for the BigTreeTech Octopus V1.
# To use this config, the firmware should be compiled for the STM32F446 with a "32KiB bootloader"
# Enable "extra low-level configuration options" and select the "12MHz crystal" as clock reference

# after running "make", copy the generated "klipper/out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the OctoPus with that SD card.

# See docs/Config_Reference.md for a description of parameters.

## Voron Design VORON2 250/300/350mm BigTreeTech OctoPus V1 TMC2209 UART config

[include mainsail.cfg]
[include homing.cfg]
[include bed_mesh.cfg]
[include stealthburner_leds.cfg]
[include KAMP_Settings.cfg]
[include canbus.cfg]
[include bedfans.cfg]
[include macros.cfg]
[include beacon.cfg]

[exclude_object]

[force_move]
enable_force_move: True
[pause_resume]

[mcu]
canbus_uuid: 993242c5d629

[printer]
kinematics: corexy
max_velocity: 500  
max_accel:7000              #Max 4000
max_z_velocity: 50          #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 300
square_corner_velocity: 5.0

#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to MOTOR_0
##  Endstop connected to DIAG_0
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_x:virtual_endstop
#position_min: 0


##  Uncomment for 300mm build
position_endstop: 306
position_max: 306
homing_speed: 40   #Max 100
homing_retract_dist: 0
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_x]
uart_pin: PC4
interpolate: false
run_current: 1.0
sense_resistor: 0.110
diag_pin: ^PG6
driver_SGTHRS: 135 # 255 is most sensitive value, 0 is least sensitive
stealthchop_threshold:0 #always on, 0 is off

##  A Stepper - Right
##  Connected to MOTOR_1
##  Endstop connected to DIAG_1
[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400  #set to 400 for 0.9 degree stepper
endstop_pin: tmc2209_stepper_y:virtual_endstop
#position_min: 0


##  Uncomment for 300mm build
position_endstop: 314
position_max: 314
homing_speed: 40  #Max 100
homing_retract_dist: 0.5
homing_positive_dir: true

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_y]
uart_pin: PD11
interpolate: false
run_current: 1.0
sense_resistor: 0.110
diag_pin: ^PG9
driver_SGTHRS: 142 # 255 is most sensitive value, 0 is least sensitive
stealthchop_threshold:0 #always on, 0 is off
 
#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to MOTOR_2
##  Endstop connected to DIAG_2
[stepper_z]
step_pin: PF11
dir_pin: PG3
enable_pin: !PG5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16
endstop_pin: probe:z_virtual_endstop # use beacon as virtual endstop
homing_retract_dist: 0 # beacon needs this to be set to 0 
#position_endstop: -0.5


##--------------------------------------------------------------------
##  Uncomment below for 300mm build
position_max: 260
position_min: -5
homing_speed: 20
second_homing_speed: 3
homing_retract_dist: 3

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z]
uart_pin: PC6
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Left
##  Connected to MOTOR_3
[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Rear Right
##  Connected to MOTOR_4
[stepper_z2]
step_pin: PF9
dir_pin: PF10
enable_pin: !PG2
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z3 Stepper - Front Right
##  Connected to MOTOR_5
[stepper_z3]
step_pin: PC13
dir_pin: !PF0
enable_pin: !PF1
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##  Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z3]
uart_pin: PE4
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
#   Bed Heater
#####################################################################
[heater_bed]
heater_pin: PA1
sensor_type: Generic 3950
sensor_pin: PF3
##  Adjust Max Power so your heater doesn't warp your bed. Rule of thumb is 0.4 watts / cm^2 .
max_power: 0.85
min_temp: 0
max_temp: 125
[verify_heater heater_bed]
max_error: 120
# The default is 120.
check_gain_time:60
# The default is 20 seconds for extruders
#   and 60 seconds for heater_bed.
hysteresis: 5
#    The default is 5.
heating_gain: 2
#    The default is 2.

#####################################################################
#   Fan Control
#####################################################################
##  Controller fan - FAN2
[controller_fan Octopus_fan]
pin: PD14
kick_start_time: 0.5
heater: heater_bed

##  Exhaust fan - FAN3
[fan_generic Exhaust_Fan]
pin: PD13
max_power: 1.0
shutdown_speed: 0.0
kick_start_time: 0.5

#####################################################################
#   LED Control
#####################################################################

## Chamber Lighting - HE2 Connector (Optional)
[output_pin Chamber_LED]
pin: PD15
pwm:true
shutdown_value: 0
value:0.75
cycle_time: 0.01

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################
[idle_timeout]
timeout: 1800

[quad_gantry_level]
gantry_corners:
	-60,-10
	360,370
##	Probe points
points:
	50,25
	50,225
	250,225
	250,25
speed: 600
horizontal_move_z: 10
retries: 10
retry_tolerance: 0.0075
max_adjust: 10

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 54.137
#*# pid_ki = 2.472
#*# pid_kd = 296.400
#*#
#*# [probe]
#*# z_offset = -0.410
#*#
#*# [input_shaper]
#*# shaper_type_x = ei
#*# shaper_freq_x = 60.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 39.4
#*#
#*# [beacon model default]
#*# model_coef = 1.7756842564643547,
#*# 	  2.0383602309658544,
#*# 	  0.6047674354552829,
#*# 	  0.30858278218480983,
#*# 	  0.24740427348977845,
#*# 	  -0.04350403955376604,
#*# 	  -0.13226724908767137,
#*# 	  0.14272135982543963,
#*# 	  0.10619338638776032,
#*# 	  -0.042497217575236466
#*# model_domain = 1.9090007618859247e-07,1.940089171082431e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 45.285838
#*# model_offset = 0.39000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.035768, 0.016200, -0.002401, -0.018837, -0.030673, -0.033875, -0.026377, -0.022906, -0.030401, -0.038064, -0.037698, -0.028917, -0.018465, -0.006438, 0.008040, 0.017166, 0.022675, 0.027394, 0.037292, 0.046531
#*# 	0.036349, 0.022137, 0.008814, -0.007474, -0.018851, -0.025090, -0.023090, -0.023275, -0.028842, -0.033527, -0.030676, -0.022514, -0.013828, -0.005684, 0.003463, 0.012975, 0.025118, 0.032167, 0.039843, 0.046522
#*# 	0.036408, 0.023352, 0.011021, -0.001536, -0.015097, -0.024632, -0.028663, -0.030580, -0.034844, -0.035742, -0.030801, -0.021679, -0.012960, -0.006611, 0.001417, 0.011302, 0.020349, 0.029132, 0.036142, 0.045760
#*# 	0.044309, 0.032796, 0.020722, 0.009707, -0.002613, -0.010573, -0.019213, -0.025298, -0.026397, -0.025527, -0.021652, -0.012888, -0.002174, 0.008077, 0.016959, 0.021744, 0.028365, 0.033745, 0.040876, 0.052743
#*# 	0.042399, 0.030970, 0.018559, 0.007175, -0.004195, -0.011710, -0.019278, -0.025095, -0.027140, -0.026048, -0.024893, -0.017126, -0.004302, 0.013536, 0.024743, 0.024421, 0.022957, 0.025432, 0.035135, 0.045881
#*# 	0.037317, 0.026218, 0.012622, -0.000222, -0.012608, -0.020190, -0.025912, -0.030197, -0.033424, -0.033526, -0.031810, -0.026987, -0.014144, 0.004768, 0.019762, 0.014028, 0.010338, 0.015478, 0.022981, 0.033853
#*# 	0.043011, 0.032840, 0.020573, 0.006768, -0.008273, -0.016943, -0.021468, -0.024640, -0.027240, -0.027762, -0.027341, -0.022177, -0.013317, -0.000140, 0.008775, 0.010832, 0.012550, 0.019431, 0.027473, 0.036126
#*# 	0.052465, 0.040637, 0.026138, 0.012866, -0.000649, -0.009240, -0.015318, -0.016376, -0.019461, -0.020253, -0.020150, -0.015702, -0.008848, -0.002335, 0.006821, 0.012480, 0.020607, 0.025779, 0.034556, 0.044402
#*# 	0.059565, 0.045132, 0.029892, 0.016443, 0.003163, -0.005335, -0.009812, -0.009906, -0.011091, -0.012047, -0.011981, -0.009430, -0.005001, 0.001164, 0.009378, 0.017753, 0.025817, 0.032185, 0.038140, 0.049836
#*# 	0.068554, 0.050783, 0.033933, 0.020539, 0.008780, 0.000028, -0.004099, -0.003697, -0.004455, -0.005334, -0.005584, -0.003836, -0.001263, 0.005270, 0.012337, 0.019454, 0.027944, 0.033776, 0.039663, 0.050312
#*# 	0.074183, 0.052035, 0.034095, 0.022728, 0.013428, 0.005643, -0.002178, -0.001735, -0.000179, -0.000929, -0.002449, 0.000439, 0.002016, 0.006237, 0.013667, 0.021527, 0.026975, 0.033850, 0.041304, 0.052132
#*# 	0.069907, 0.049435, 0.033758, 0.024303, 0.014686, 0.006890, 0.000242, -0.000676, -0.000062, 0.000756, 0.000614, 0.002087, 0.003212, 0.008322, 0.014037, 0.019159, 0.027213, 0.032544, 0.039868, 0.050494
#*# 	0.059572, 0.046497, 0.034022, 0.024075, 0.015041, 0.008703, 0.002202, 0.001968, 0.001532, 0.001977, 0.001797, 0.004197, 0.006130, 0.008417, 0.014363, 0.020960, 0.027417, 0.035151, 0.043292, 0.051481
#*# 	0.046195, 0.038684, 0.026819, 0.016922, 0.008046, 0.002555, -0.001802, -0.002971, -0.003641, -0.003476, -0.003155, -0.001084, 0.000158, 0.001967, 0.010831, 0.018626, 0.023036, 0.029020, 0.035957, 0.045133
#*# 	0.035845, 0.025881, 0.016686, 0.008659, -0.000656, -0.003130, -0.007251, -0.009549, -0.010470, -0.008709, -0.009683, -0.007046, -0.005507, -0.001417, 0.009788, 0.019076, 0.023190, 0.023333, 0.030765, 0.038295
#*# 	0.034035, 0.025773, 0.014981, 0.006092, 0.001252, -0.004043, -0.005636, -0.008472, -0.010511, -0.007208, -0.006600, -0.004704, -0.000657, 0.005317, 0.020633, 0.031715, 0.030687, 0.028052, 0.033285, 0.042521
#*# 	0.037064, 0.028169, 0.017492, 0.009244, 0.004461, 0.001177, -0.001948, -0.003992, -0.003826, -0.003544, -0.002008, 0.001197, 0.006358, 0.013715, 0.028646, 0.037175, 0.033781, 0.035091, 0.040601, 0.052572
#*# 	0.036126, 0.028140, 0.019941, 0.011523, 0.006772, 0.001100, -0.002601, -0.002256, -0.003548, -0.001349, -0.002497, 0.000618, 0.007541, 0.013796, 0.024750, 0.029463, 0.032060, 0.036589, 0.046771, 0.056343
#*# 	0.035457, 0.028409, 0.020529, 0.012286, 0.006491, -0.000672, -0.004207, -0.004150, -0.003957, -0.003121, -0.003186, 0.000159, 0.007812, 0.014312, 0.022597, 0.024895, 0.027906, 0.033296, 0.045786, 0.056302
#*# 	0.028790, 0.019174, 0.014673, 0.007990, 0.000231, -0.005659, -0.008658, -0.009359, -0.008636, -0.008385, -0.005574, -0.003847, 0.002879, 0.011760, 0.016413, 0.018631, 0.020700, 0.029278, 0.041151, 0.054393
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 1
#*# mesh_y_pps = 1
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 250.0
#*# min_y = 30.0
#*# max_y = 250.0
